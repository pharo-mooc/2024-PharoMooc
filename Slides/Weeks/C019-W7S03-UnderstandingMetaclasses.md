{"title" : "Understanding Metaclasses","slidesid" : "W7S03"}# What You Will Learn- Not needed to program in Pharo :\)- But intellectually exciting  - Where `new` is defined?  - What is the class of a metaclass?  - Uniformity of the instance relationship# The Key: Only One Method Lookup<!columns|width=100<!column|width=60When a message is sent to an object, a method is searched starting from the class of the object and following the inheritance chain!><!column|width=40![](figures/LookupEssenceWithGeneric.png width=150)!>!># Metaclasses in 7 Points1. Every object is an instance of a class1. Every class eventually inherits from `Object`1. Every class is an instance of a metaclass1. The metaclass hierarchy parallels the class hierarchy1. Every metaclass inherits from `Class` up to `Behavior`1. Every metaclass is an instance of `Metaclass`1. The metaclass of `Metaclass` is an instance of `Metaclass`# Metaclasses in 7 Points1. **Every object is an instance of a class**1. Every class eventually inherits from `Object`1. Every class is an instance of a metaclass1. The metaclass hierarchy parallels the class hierarchy1. Every metaclass inherits from `Class` up to `Behavior`1. Every metaclass is an instance of `Metaclass`1. The metaclass of `Metaclass` is an instance of `Metaclass`# Every Object is an Instance of a Class![](figures/01-SortedCollectionInstanceOfSortedCollection.png width=60)# Metaclasses in 7 Points1. Every object is an instance of a class1. **Every class eventually inherits from `Object`**1. Every class is an instance of a metaclass1. The metaclass hierarchy parallels the class hierarchy1. Every metaclass inherits from `Class` up to `Behavior`1. Every metaclass is an instance of `Metaclass`1. The metaclass of `Metaclass` is an instance of `Metaclass`# Every Class Eventually Inherits From Object![](figures/02-SortedCollectionInheritsFromObject.png width=70)# Responsibility of ObjectClass `Object` represents the common object behavior- error handling, halting, announcements- all classes eventually inherit from `Object` # Metaclasses in 7 Points1. Every object is an instance of a class1. Every class eventually inherits from `Object`1. **Every class is an instance of a metaclass**1. The metaclass hierarchy parallels the class hierarchy1. Every metaclass inherits from `Class` up to `Behavior`1. Every metaclass is an instance of `Metaclass`1. The metaclass of `Metaclass` is an instance of `Metaclass`# Every class is an instance of a metaclassClasses are objects too!- Every class `X` is the unique instance of its metaclass, called `X class`![](figures/04-OrderedCollectionIsInstanceOfOrderedCollectionClass.png width=110)# Metaclass are ImplicitMetaclasses are automatically created when creating a class# Metaclasses in 7 Points1. Every object is an instance of a class1. Every class eventually inherits from `Object`1. Every class is an instance of a metaclass1. **The metaclass hierarchy parallels the class hierarchy**1. Every metaclass inherits from `Class` up to `Behavior`1. Every metaclass is an instance of `Metaclass`1. The metaclass of `Metaclass` is an instance of `Metaclass`# Metaclass Hierarchy Parallels Class Hierarchy![](figures/05-OrderedCollectionIsInstanceOfOrderedCollectionClassInherit width=120)# Sending a Message to a Class![](figures/06-OrderedCollectionIsInstanceOfOrderedCollectionClass width=140)# Questions- What is the class of a metaclass?- What is the superclass of `Object class`?- What about sending a message to a metaclass?![](figures/07-2Questions.png width=110)# Metaclasses in 7 Points1. Every object is an instance of a class1. Every class eventually inherits from `Object`1. Every class is an instance of a metaclass1. The metaclass hierarchy parallels the class hierarchy1. **Every metaclass inherits from `Class` up to `Behavior`**1. Every metaclass is an instance of `Metaclass`1. The metaclass of `Metaclass` is an instance of `Metaclass`# Every Metaclass Inherits from Class up to Behavior![](figures/08-BehaviorClassDescriptionAndClass.png width=100)# Where new is Defined?![](figures/09-BehaviorClassDescriptionAndClassWithNew.png width=100)# Responsibilities of Behavior`Behavior`- Minimum state for objects that **have instances**- State:  - superclass link, method dictionary, description of instances \(representation and number\)- Methods:  - method dictionary, compiling method  - instance creation \(`new`, `basicNew`, `new:`, `basicNew:`\)  - class hierarchy manipulation \(`superclass:`, `addSubclass:`\)   - accessing \(`selectors`, `allSelectors`, `compiledMethodAt:`, `allInstances`, `instVarNames`\) # Responsibilities of ClassDescription`ClassDescription`- Abstract class superclass of `Class` and `Metaclass`- Adds a number of facilities to `Behavior`:  - named instance variables  - category organization for methods  - the notion of a name \(abstract\)  - maintenance of Change sets and logging changes  - most of the mechanisms needed for fileOut# Responsibilities of Class`Class`- represents the common behavior of all classes  - name, compilation, method storing, instance variables ...- representation for classVariable names \(`addClassVarName:`, `initialize`\)# Classes are Instances of MetaclassesMetaclass and class inheritances are parallel![](figures/10-BehaviorClassDescriptionAndClassWithMetaclasses.png width=100)# Metaclasses in 7 Points1. Every object is an instance of a class1. Every class eventually inherits from `Object`1. Every class is an instance of a metaclass1. The metaclass hierarchy parallels the class hierarchy1. Every metaclass inherits from `Class` up to `Behavior`1. **Every metaclass is an instance of `Metaclass`**1. The metaclass of `Metaclass` is an instance of `Metaclass`# Every Metaclass is an Instance of Metaclass`Metaclass` inherits from `ClassDescription`![](figures/11-BehaviorClassDescriptionAndClassWithMetaclassesInstanceOfMetaclass.png width=115)# Metaclass Responsibilities`Metaclass` is responsible for creating and initializing a metaclass's sole instance \(a Class\)# Metaclasses in 7 Points1. Every object is an instance of a class1. Every class eventually inherits from `Object`1. Every class is an instance of a metaclass1. The metaclass hierarchy parallels the class hierarchy1. Every metaclass inherits from `Class` up to `Behavior`1. Every metaclass is an instance of `Metaclass`1. **The metaclass of `Metaclass` is an instance of `Metaclass`**# The metaclass of Metaclass is an Instance of Metaclass![](figures/12-FullMetaclasses.png width=130)# Observations<!columns|width=100<!column|width=70- When programming we do not really care about that!- Now the full graph is consistent  - Any class can receive a message   - Only one message lookup!><!column|width=30![](figures/LookupEssenceWithGeneric.png width=180)!>!># A Consistent World![](figures/12-FullMetaclasses.png width=130)# What You Should Know- Classes are objects and can receive messages- The process is **exactly** the same as for any other objects